<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>·ä†·à∞·çã ·ã≤·åÇ·â≥·àç ·â¢·äï·åé ·å®·ãã·â≥ - Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Ethiopic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ADMIN STYLES */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Times New Roman', 'Noto Sans Ethiopic', sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            color: white;
            touch-action: manipulation;
        }

        .amharic-text {
            font-family: 'Noto Sans Ethiopic', 'Times New Roman', sans-serif;
        }

        /* ADMIN CONTAINER */
        .admin-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 10px;
            background: linear-gradient(45deg, #28a745 0%, #ffd700 33%, #dc3545 66%, #28a745 100%);
            animation: borderGlow 3s infinite alternate;
        }

        .admin-main {
            width: 100%;
            height: 100%;
            background: #0d47a1;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* ADMIN HEADER */
        .admin-header {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-bottom: 3px solid #ffd700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            color: #ffd700;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            flex: 1;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            border: 2px solid #28a745;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #dc3545;
        }

        .status-dot.connected {
            background: #28a745;
            animation: pulse 2s infinite;
        }

        .status-text {
            font-size: 14px;
            color: white;
        }

        /* ADMIN CONTENT */
        .admin-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* LEFT PANEL - PLAYERS */
        .players-panel {
            width: 300px;
            background: rgba(0, 0, 0, 0.2);
            border-right: 3px solid #ffd700;
            padding: 15px;
            overflow-y: auto;
        }

        .panel-title {
            color: #ffd700;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffd700;
        }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 12px;
            transition: all 0.3s;
        }

        .player-card.active {
            background: rgba(40, 167, 69, 0.3);
            border-color: #ffd700;
            transform: scale(1.02);
        }

        .player-card.winner {
            background: rgba(255, 215, 0, 0.3);
            border-color: #dc3545;
            animation: pulse 1s infinite;
        }

        .player-name {
            color: #ffd700;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .player-stake {
            color: #28a745;
            font-weight: bold;
        }

        .player-boards {
            color: #17a2b8;
        }

        /* MIDDLE PANEL - GAME CONTROL */
        .game-control-panel {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-section {
            background: rgba(0, 0, 0, 0.3);
            border: 3px solid #ffd700;
            border-radius: 12px;
            padding: 20px;
        }

        .section-title {
            color: #ffd700;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        /* GAME SETUP */
        .game-setup-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .setup-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .setup-label {
            color: #ffd700;
            font-size: 14px;
            font-weight: bold;
        }

        .setup-control {
            width: 100%;
            height: 40px;
            padding: 0 10px;
            border: 2px solid #000;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            background: white;
            color: #333;
        }

        /* NUMBER CONTROL */
        .number-control-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .current-number-display {
            width: 100px;
            height: 100px;
            background: #dc3545;
            border: 5px solid #ffd700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            color: white;
            animation: pulse 2s infinite;
        }

        .control-btn-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #000;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .control-btn-large:active {
            transform: scale(0.95);
        }

        .call-btn {
            background: #28a745;
            color: white;
        }

        .reset-btn {
            background: #dc3545;
            color: white;
        }

        /* CALLED NUMBERS */
        .called-numbers-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
        }

        .called-number {
            width: 50px;
            height: 50px;
            background: #ffd700;
            border: 2px solid #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: #0d47a1;
            animation: slideIn 0.3s;
        }

        /* WINNER CONTROL */
        .winner-control-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .winner-info {
            background: rgba(40, 167, 69, 0.2);
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .winner-name {
            color: #ffd700;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .winner-pattern {
            color: white;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .winner-amount {
            color: #28a745;
            font-size: 24px;
            font-weight: bold;
        }

        /* RIGHT PANEL - STATISTICS */
        .stats-panel {
            width: 300px;
            background: rgba(0, 0, 0, 0.2);
            border-left: 3px solid #ffd700;
            padding: 15px;
            overflow-y: auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #17a2b8;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            color: #ffd700;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
        }

        /* TRANSACTIONS */
        .transactions-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .transaction-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #ffd700;
            border-radius: 6px;
            padding: 10px;
            font-size: 12px;
        }

        .transaction-amount {
            color: #28a745;
            font-weight: bold;
        }

        /* ADMIN FOOTER */
        .admin-footer {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-top: 3px solid #ffd700;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .footer-btn {
            min-width: 150px;
            height: 50px;
            border: 2px solid #000;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .footer-btn:active {
            transform: scale(0.95);
        }

        .start-game-btn {
            background: #28a745;
            color: white;
        }

        .pause-game-btn {
            background: #ffd700;
            color: #0d47a1;
        }

        .end-game-btn {
            background: #dc3545;
            color: white;
        }

        /* MODALS */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #0d47a1;
            border: 5px solid #ffd700;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            color: #ffd700;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ffd700;
        }

        /* ANIMATIONS */
        @keyframes borderGlow {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #ffd700;
            border-radius: 4px;
        }

        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .players-panel, .stats-panel {
                width: 250px;
            }
        }

        @media (max-width: 992px) {
            .admin-content {
                flex-direction: column;
            }
            
            .players-panel, .stats-panel {
                width: 100%;
                border: none;
                border-bottom: 3px solid #ffd700;
            }
            
            .game-control-panel {
                order: 1;
            }
            
            .players-panel {
                order: 2;
            }
            
            .stats-panel {
                order: 3;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-main">
            <!-- Admin Header -->
            <div class="admin-header">
                <div class="connection-status">
                    <div class="status-dot" id="statusDot"></div>
                    <div class="status-text" id="statusText">·â∞·åà·äì·äù·â∑·àç...</div>
                </div>
                <div class="admin-title amharic-text">·ä†·à∞·çã ·ã≤·åÇ·â≥·àç ·â¢·äï·åé - ·ä†·àµ·â∞·ã≥·ã∞·à≠ ·çì·äê·àç</div>
                <div style="width: 150px;"></div>
            </div>

            <!-- Admin Content -->
            <div class="admin-content">
                <!-- Left Panel: Players -->
                <div class="players-panel">
                    <div class="panel-title amharic-text">·â∞·å´·ãã·âæ·âΩ (<span id="playerCount">0</span>/90)</div>
                    <div class="players-list" id="playersList">
                        <!-- Players will be dynamically added here -->
                    </div>
                </div>

                <!-- Middle Panel: Game Control -->
                <div class="game-control-panel">
                    <!-- Game Setup -->
                    <div class="control-section">
                        <div class="section-title amharic-text">·ã®·å®·ãã·â≥ ·àõ·ãã·âÄ·à™·ã´</div>
                        <div class="game-setup-grid">
                            <div class="setup-item">
                                <label class="setup-label amharic-text">·ã®·å®·ãã·â≥ ·ä†·ã≠·äê·âµ</label>
                                <select class="setup-control" id="gameTypeSelect">
                                    <option value="75ball">75-·â¢·äï·åé</option>
                                    <option value="90ball">90-·â¢·äï·åé</option>
                                    <option value="30ball">30-·â¢·äï·åé</option>
                                    <option value="50ball">50-·â¢·äï·åé</option>
                                    <option value="pattern">·äï·ãµ·çç ·â¢·äï·åé</option>
                                    <option value="coverall">·àô·àâ ·â§·âµ</option>
                                </select>
                            </div>
                            <div class="setup-item">
                                <label class="setup-label amharic-text">·ã®·àò·å†·à™·ã´ ·ä≠·çç·â∞·âµ</label>
                                <select class="setup-control" id="callIntervalSelect">
                                    <option value="3000">3 ·à∞·ä®·äï·ãµ</option>
                                    <option value="5000" selected>5 ·à∞·ä®·äï·ãµ</option>
                                    <option value="7000">7 ·à∞·ä®·äï·ãµ</option>
                                    <option value="10000">10 ·à∞·ä®·äï·ãµ</option>
                                </select>
                            </div>
                            <div class="setup-item">
                                <label class="setup-label amharic-text">·ä®·çç·â∞·äõ ·ãç·à≠·à≠·ãµ</label>
                                <select class="setup-control" id="maxStakeSelect">
                                    <option value="25">25 ·â•·à≠</option>
                                    <option value="50">50 ·â•·à≠</option>
                                    <option value="100" selected>100 ·â•·à≠</option>
                                    <option value="200">200 ·â•·à≠</option>
                                    <option value="500">500 ·â•·à≠</option>
                                </select>
                            </div>
                            <div class="setup-item">
                                <label class="setup-label amharic-text">·ã®·àõ·à∏·äê·çç ·ä†·ã≠·äê·âµ</label>
                                <select class="setup-control" id="winTypeSelect">
                                    <option value="auto">·à´·àµ-·à∞·à≠</option>
                                    <option value="manual" selected>·ä•·åÖ</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Number Control -->
                    <div class="control-section">
                        <div class="section-title amharic-text">·âÅ·å•·à≠ ·àò·å•·à´·âµ</div>
                        <div class="number-control-container">
                            <button class="control-btn-large reset-btn" onclick="resetGame()">üîÑ</button>
                            <div class="current-number-display" id="currentNumberDisplay">-</div>
                            <button class="control-btn-large call-btn" onclick="callNextNumber()">üì¢</button>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <div class="section-title amharic-text">·ã®·â∞·å†·à© ·âÅ·å•·àÆ·âΩ (<span id="calledCount">0</span>)</div>
                            <div class="called-numbers-container" id="calledNumbersContainer">
                                <!-- Called numbers will appear here -->
                            </div>
                        </div>
                    </div>

                    <!-- Winner Control -->
                    <div class="control-section">
                        <div class="section-title amharic-text">·ä†·à∏·äì·çä ·àõ·àµ·â∞·ã≥·ã∞·à≠</div>
                        <div class="winner-control-container" id="winnerControlContainer">
                            <div style="text-align: center; color: #ffd700; font-size: 16px; padding: 20px;">
                                ·ä†·à∏·äì·çä ·ã®·àà·àù·ç¢ ·å®·ãã·â≥·ãç·äï ·ã≠·åÄ·àù·à©!
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Statistics -->
                <div class="stats-panel">
                    <div class="panel-title amharic-text">·àµ·â≥·â≤·àµ·â≤·ä≠·àµ</div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalRevenue">0</div>
                            <div class="stat-label amharic-text">·å†·âÖ·àã·àã ·åà·â¢</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalPayout">0</div>
                            <div class="stat-label amharic-text">·å†·âÖ·àã·àã ·àΩ·àç·àõ·âµ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="activeGames">0</div>
                            <div class="stat-label amharic-text">·äï·âÅ ·å®·ãã·â≥·ãé·âΩ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalWins">0</div>
                            <div class="stat-label amharic-text">·å†·âÖ·àã·àã ·ä†·à∏·äì·çä·ãé·âΩ</div>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <div class="panel-title amharic-text">·ã®·âÖ·à≠·â• ·åç·â•·ã≠·â∂·âΩ</div>
                        <div class="transactions-list" id="transactionsList">
                            <!-- Transactions will appear here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Footer -->
            <div class="admin-footer">
                <button class="footer-btn start-game-btn" onclick="startGame()">
                    <span>‚ñ∂Ô∏è</span>
                    <span class="amharic-text">·å®·ãã·â≥ ·åÄ·àù·à≠</span>
                </button>
                <button class="footer-btn pause-game-btn" onclick="pauseGame()">
                    <span>‚è∏Ô∏è</span>
                    <span class="amharic-text">·àà·åä·ãú·ãç ·ä†·âÅ·àù</span>
                </button>
                <button class="footer-btn end-game-btn" onclick="endGame()">
                    <span>‚èπÔ∏è</span>
                    <span class="amharic-text">·å®·ãã·â≥ ·ä†·âÅ·àù</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Winner Announcement Modal -->
    <div class="modal" id="winnerModal">
        <div class="modal-content">
            <div class="modal-header amharic-text">·ä†·ã≤·àµ ·ä†·à∏·äì·çä! üéâ</div>
            <div id="winnerModalContent">
                <!-- Winner details will be dynamically added -->
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="footer-btn start-game-btn" style="flex: 1;" onclick="closeWinnerModal()">
                    <span class="amharic-text">·ä•·à∫</span>
                </button>
                <button class="footer-btn pause-game-btn" style="flex: 1;" onclick="verifyWinner()">
                    <span class="amharic-text">·ä†·à®·åã·åç·å•</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            ws: null,
            isConnected: false,
            isAdmin: false,
            gameActive: false,
            gameType: '75ball',
            calledNumbers: [],
            players: [],
            statistics: {
                totalRevenue: 0,
                totalPayout: 0,
                activeGames: 0,
                totalWins: 0
            },
            transactions: [],
            autoCallInterval: null,
            currentWinner: null
        };

        // Initialize WebSocket connection
        function initWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
            const host = window.location.host;
            const wsUrl = `${protocol}${host}/ws?admin=true&password=asse2123`;
            
            gameState.ws = new WebSocket(wsUrl);
            
            gameState.ws.onopen = function() {
                console.log('WebSocket connected as admin');
                gameState.isConnected = true;
                updateConnectionStatus(true);
                
                // Request initial data
                gameState.ws.send(JSON.stringify({
                    type: 'admin_connect',
                    timestamp: Date.now()
                }));
            };
            
            gameState.ws.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    handleMessage(data);
                } catch (error) {
                    console.error('Error parsing message:', error);
                }
            };
            
            gameState.ws.onclose = function() {
                console.log('WebSocket disconnected');
                gameState.isConnected = false;
                updateConnectionStatus(false);
                
                // Try to reconnect after 5 seconds
                setTimeout(initWebSocket, 5000);
            };
            
            gameState.ws.onerror = function(error) {
                console.error('WebSocket error:', error);
                updateConnectionStatus(false);
            };
        }

        // Update connection status UI
        function updateConnectionStatus(connected) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            if (connected) {
                statusDot.className = 'status-dot connected';
                statusText.textContent = '·â∞·åà·äì·äù·â∑·àç';
                statusText.style.color = '#28a745';
            } else {
                statusDot.className = 'status-dot';
                statusText.textContent = '·ä†·àç·â∞·åà·äì·äò·àù';
                statusText.style.color = '#dc3545';
            }
        }

        // Handle incoming messages
        function handleMessage(data) {
            switch (data.type) {
                case 'admin_verified':
                    gameState.isAdmin = true;
                    showNotification('·ä†·àµ·â∞·ã≥·ã∞·à≠ ·ä•·äï·ã∞·â∞·çà·âÄ·ã∞ ·â∞·åà·äì·äù·â∞·ãã·àç');
                    break;
                    
                case 'player_joined':
                    addPlayer(data.player);
                    updateStatistics();
                    break;
                    
                case 'player_left':
                    removePlayer(data.playerId);
                    updateStatistics();
                    break;
                    
                case 'payment_received':
                    addTransaction(data);
                    updateStatistics();
                    break;
                    
                case 'number_called':
                    updateCalledNumbers(data.number, data.display);
                    break;
                    
                case 'winner_announced':
                    showWinner(data);
                    break;
                    
                case 'game_started':
                    gameState.gameActive = true;
                    gameState.calledNumbers = [];
                    updateCalledNumbersUI();
                    showNotification('·å®·ãã·â≥ ·åÄ·àù·àØ·àç!');
                    break;
                    
                case 'game_ended':
                    gameState.gameActive = false;
                    showNotification('·å®·ãã·â≥ ·ä†·â•·âÖ·â∑·àç!');
                    break;
                    
                case 'player_list':
                    updatePlayerList(data.players);
                    break;
                    
                case 'statistics_update':
                    updateStatistics(data.statistics);
                    break;
            }
        }

        // Send message to server
        function sendMessage(type, data = {}) {
            if (!gameState.ws || gameState.ws.readyState !== WebSocket.OPEN) {
                console.error('WebSocket is not connected');
                return;
            }
            
            const message = {
                type: type,
                ...data,
                timestamp: Date.now()
            };
            
            gameState.ws.send(JSON.stringify(message));
        }

        // Update player list
        function updatePlayerList(players) {
            gameState.players = players;
            const playersList = document.getElementById('playersList');
            const playerCount = document.getElementById('playerCount');
            
            playersList.innerHTML = '';
            playerCount.textContent = players.length;
            
            players.forEach(player => {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                if (player.isActive) playerCard.classList.add('active');
                if (player.hasWon) playerCard.classList.add('winner');
                
                playerCard.innerHTML = `
                    <div class="player-name amharic-text">${player.name}</div>
                    <div class="player-info">
                        <div class="player-stake">${player.stake} ·â•·à≠</div>
                        <div class="player-boards">·â¶·à≠·ãµ: ${player.boardId}</div>
                        <div>üì± ${player.phone}</div>
                    </div>
                    ${player.hasWon ? '<div style="color:#ffd700;font-size:12px;margin-top:5px;">üéâ ·ä†·à∏·äì·çä!</div>' : ''}
                `;
                
                playersList.appendChild(playerCard);
            });
        }

        // Add a player
        function addPlayer(player) {
            const playersList = document.getElementById('playersList');
            const playerCard = document.createElement('div');
            playerCard.className = 'player-card active';
            
            playerCard.innerHTML = `
                <div class="player-name amharic-text">${player.name}</div>
                <div class="player-info">
                    <div class="player-stake">${player.stake} ·â•·à≠</div>
                    <div class="player-boards">·â¶·à≠·ãµ: ${player.boardId}</div>
                    <div>üì± ${player.phone}</div>
                </div>
            `;
            
            playersList.prepend(playerCard);
            gameState.playerCount++;
        }

        // Remove a player
        function removePlayer(playerId) {
            const playersList = document.getElementById('playersList');
            const cards = playersList.getElementsByClassName('player-card');
            
            for (let card of cards) {
                // In a real app, we'd have player IDs in the card data
                // For now, we'll just remove the first card
                if (card.textContent.includes(playerId)) {
                    card.remove();
                    break;
                }
            }
        }

        // Update called numbers
        function updateCalledNumbers(number, display) {
            gameState.calledNumbers.push({ number, display });
            updateCalledNumbersUI();
            
            // Update current number display
            document.getElementById('currentNumberDisplay').textContent = display || number;
            
            // Play sound
            playCallSound();
        }

        // Update called numbers UI
        function updateCalledNumbersUI() {
            const container = document.getElementById('calledNumbersContainer');
            const count = document.getElementById('calledCount');
            
            container.innerHTML = '';
            count.textContent = gameState.calledNumbers.length;
            
            // Show last 20 numbers
            const recentNumbers = gameState.calledNumbers.slice(-20);
            
            recentNumbers.forEach(item => {
                const numberDiv = document.createElement('div');
                numberDiv.className = 'called-number';
                numberDiv.textContent = item.display || item.number;
                container.appendChild(numberDiv);
            });
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }

        // Update statistics
        function updateStatistics(stats) {
            if (stats) {
                gameState.statistics = stats;
            }
            
            document.getElementById('totalRevenue').textContent = 
                gameState.statistics.totalRevenue.toLocaleString();
            document.getElementById('totalPayout').textContent = 
                gameState.statistics.totalPayout.toLocaleString();
            document.getElementById('activeGames').textContent = 
                gameState.statistics.activeGames;
            document.getElementById('totalWins').textContent = 
                gameState.statistics.totalWins;
        }

        // Add transaction
        function addTransaction(transaction) {
            const transactionsList = document.getElementById('transactionsList');
            
            const transactionItem = document.createElement('div');
            transactionItem.className = 'transaction-item';
            
            const time = new Date(transaction.timestamp).toLocaleTimeString();
            const amount = transaction.amount || transaction.stake || 0;
            
            transactionItem.innerHTML = `
                <div style="display: flex; justify-content: space-between;">
                    <span>${transaction.playerName || 'Guest'}</span>
                    <span class="transaction-amount">+${amount} ·â•·à≠</span>
                </div>
                <div style="font-size: 10px; color: #888; margin-top: 3px;">${time}</div>
            `;
            
            transactionsList.prepend(transactionItem);
            
            // Keep only last 10 transactions
            const items = transactionsList.getElementsByClassName('transaction-item');
            if (items.length > 10) {
                transactionsList.removeChild(items[items.length - 1]);
            }
            
            // Update statistics
            gameState.statistics.totalRevenue += amount;
            updateStatistics();
        }

        // Show winner
        function showWinner(winnerData) {
            gameState.currentWinner = winnerData;
            
            const modal = document.getElementById('winnerModal');
            const content = document.getElementById('winnerModalContent');
            
            content.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üéâ</div>
                    <div class="winner-name amharic-text" style="font-size: 24px; color: #ffd700; margin-bottom: 10px;">
                        ${winnerData.playerName}
                    </div>
                    <div class="winner-pattern amharic-text" style="font-size: 18px; margin-bottom: 15px;">
                        ${winnerData.pattern} - ·â¶·à≠·ãµ ${winnerData.boardId}
                    </div>
                    <div class="winner-amount amharic-text" style="font-size: 36px; margin-bottom: 20px;">
                        ${winnerData.winAmount.toLocaleString()} ·â•·à≠
                    </div>
                    <div style="color: #ccc; font-size: 14px;">
                        ·àµ·àç·ä≠: ${winnerData.phone}
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
            
            // Update player card
            const players = document.getElementsByClassName('player-card');
            for (let card of players) {
                if (card.textContent.includes(winnerData.playerName)) {
                    card.classList.add('winner');
                    break;
                }
            }
            
            // Update statistics
            gameState.statistics.totalWins++;
            gameState.statistics.totalPayout += winnerData.winAmount;
            updateStatistics();
            
            // Play win sound
            playWinSound();
        }

        // Close winner modal
        function closeWinnerModal() {
            document.getElementById('winnerModal').style.display = 'none';
        }

        // Verify winner
        function verifyWinner() {
            if (gameState.currentWinner) {
                sendMessage('verify_winner', {
                    playerId: gameState.currentWinner.playerId,
                    verified: true
                });
                
                closeWinnerModal();
                showNotification('·ä†·à∏·äì·çä ·â∞·à®·åã·åç·åß·àç!');
            }
        }

        // Game control functions
        function startGame() {
            const gameType = document.getElementById('gameTypeSelect').value;
            const callInterval = parseInt(document.getElementById('callIntervalSelect').value);
            const maxStake = parseInt(document.getElementById('maxStakeSelect').value);
            const winType = document.getElementById('winTypeSelect').value;
            
            sendMessage('start_game', {
                gameType,
                callInterval,
                maxStake,
                winType
            });
            
            // Start auto-calling if interval is set
            if (callInterval > 0) {
                clearInterval(gameState.autoCallInterval);
                gameState.autoCallInterval = setInterval(callNextNumber, callInterval);
            }
        }

        function pauseGame() {
            clearInterval(gameState.autoCallInterval);
            sendMessage('pause_game');
            showNotification('·å®·ãã·â≥ ·àà·åä·ãú·ãç ·â∞·âÜ·àù·â∑·àç');
        }

        function endGame() {
            clearInterval(gameState.autoCallInterval);
            sendMessage('end_game');
            showNotification('·å®·ãã·â≥ ·ä†·â•·âÖ·â∑·àç');
        }

        function resetGame() {
            gameState.calledNumbers = [];
            updateCalledNumbersUI();
            document.getElementById('currentNumberDisplay').textContent = '-';
            sendMessage('reset_numbers');
            showNotification('·âÅ·å•·àÆ·âΩ ·â∞·à∞·à≠·ãò·ãã·àç');
        }

        function callNextNumber() {
            sendMessage('call_number');
        }

        // Utility functions
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                border-left: 5px solid #28a745;
                z-index: 10000;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideIn 0.3s;
                font-family: 'Noto Sans Ethiopic';
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function playCallSound() {
            // Create audio element for call sound
            const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-bell-notification-933.mp3');
            audio.volume = 0.5;
            audio.play().catch(e => console.log('Audio play failed:', e));
        }

        function playWinSound() {
            // Create audio element for win sound
            const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3');
            audio.volume = 0.5;
            audio.play().catch(e => console.log('Audio play failed:', e));
        }

        // Initialize on load
        window.addEventListener('load', function() {
            initWebSocket();
            
            // Check if we're in admin mode
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('admin') !== 'true') {
                // Redirect to admin page with password
                window.location.href = window.location.pathname + '?admin=true';
            }
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                switch(e.key) {
                    case ' ':
                    case 'Enter':
                        if (!gameState.gameActive) startGame();
                        else callNextNumber();
                        break;
                    case 'Escape':
                        pauseGame();
                        break;
                    case 'r':
                    case 'R':
                        if (e.ctrlKey) resetGame();
                        break;
                }
            });
            
            // Prevent accidental refresh
            window.addEventListener('beforeunload', function(e) {
                if (gameState.gameActive) {
                    e.preventDefault();
                    e.returnValue = '·å®·ãã·â≥ ·ä•·ã®·â∞·å´·ãà·â∞ ·äê·ãç·ç¢ ·àõ·à®·åã·åà·å´ ·ã´·àµ·çà·àç·åç·ãé·â≥·àç!';
                }
            });
        });

        // Handle page visibility
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // Page is hidden, pause auto-calling
                clearInterval(gameState.autoCallInterval);
            } else if (gameState.gameActive) {
                // Page is visible again, restart auto-calling if needed
                const callInterval = parseInt(document.getElementById('callIntervalSelect').value);
                if (callInterval > 0) {
                    gameState.autoCallInterval = setInterval(callNextNumber, callInterval);
                }
            }
        });
    </script>
</body>
</html>